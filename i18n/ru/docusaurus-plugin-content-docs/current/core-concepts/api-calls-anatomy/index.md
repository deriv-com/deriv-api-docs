---
title: Функции вызовов API
hide_title: false
draft: false
sidebar_label: Функции вызовов API
sidebar_position: 1
tags:
  - концепция
  - звонки
  - анатомия
keywords:
  - торговое приложение
  - вызовы api
  - пример api
description: Настройте вызовы API для Вашего торгового приложения с помощью функции вызовов API. На примерах API научитесь подписываться, отправлять запросы и получать ответные данные.
---

## Подпишитесь и отправьте

Все вызовы API имеют функцию отправки, позволяющую сделать запрос и получить ответ. Некоторые вызовы API также предлагают функцию подписки, позволяющую отправлять обновления в Ваше приложение при появлении новой информации.

### Подписаться

Несколько вызовов API обеспечивают функциональность `subscribe`. Когда Вы подписываетесь на вызов API, Вы будете получать непрерывный поток данных этого конкретного вызова API.

Некоторые из этих вызовов API автоматически подписываются (например, [ticks](/api-explorer#ticks)), а некоторые имеют необязательное поле `subscribe`. Если Вы передадите `1` в поле `subscribe`, подписка начнется, и сервер будет продолжать отправлять запрошенные данные до тех пор, пока Вы не откажетесь от подписки, вызвав API-вызовы `Forget` или `Forget all`.

Например, Вы можете вызвать [Tick History](/api-explorer#ticks_history), чтобы получить данные об истории тиков. Но когда Вы добавите к этому вызову опцию \\\\\\\`subscribe, Вы получите данные об истории тиков, которые Вы запросили, в первом ответе, и будете продолжать получать новый ответ каждый раз, когда сервер будет публиковать новые тики для данного символа.

В потоке сообщений от `subscribe` есть поле под названием `subscription`. Это `идентификатор потока`. С помощью этого идентификатора Вы можете определить поток сообщений в Вашей логике и остановить поток с помощью вызовов API `Forget` и `Forget All`.

Данные, предоставленные API-вызовами с функцией `subscribe`, могут быть использованы в качестве источника данных для других API-вызовов и функций.

### Отправить

Если Вы вызываете API с функцией `send`, то сервер отправит запрошенные данные только один раз. Чтобы получить обновленные данные, Вам нужно снова отправить вызов API. Обычно этот метод используется, когда Вы получаете другие ответы на вызовы API или события пользовательского интерфейса, такие как `Click`, `Scroll` и т.д.

### Забудьте про

Если Вы хотите остановить поток сообщений, созданный `subscribe`, Вам нужно будет вызвать API-вызов `Forget` с правильным `Stream ID`. В противном случае Вы можете использовать вызов API `Forget All`, чтобы остановить потоки по их `имени метода`.

:::caution
Для получения дополнительной информации о вызове API `Forget` посмотрите [Forget](/api-explorer#forget) и [Forget All](/api-explorer#forget_all) в проводнике API.
:::

## Данные для запроса

Чтобы Вам было проще управлять потоком запросов и ответов в Вашем WebSocket-соединении, каждый вызов API Deriv WebSocket имеет стандартную структуру. Вы можете использовать его для кэширования, проверки, синхронизации запросов и ответов.

#### Имя метода вызова API

Каждый `запрос` в WebSocket API содержит поле `имя метода`, которое служит уникальным идентификатором для запроса. В большинстве случаев это `имя метода` будет иметь числовое значение `1`. Однако в некоторых случаях свойство identifier может иметь строковое значение.

:::caution
Имя метода вызова API всегда является обязательным. Это поле определяет данные, которые Вы будете получать от нашего сервера WebSocket.
:::

### Необязательные поля

Каждый запрос содержит обязательные поля, которые Вы должны указать, а также может содержать необязательные поля. Давайте рассмотрим это на примере `Residence List`.

Вызов `Residence List` возвращает список стран и 2-буквенных кодов стран, подходящих для заполнения формы открытия счета.

Ниже приведены данные запроса для этого вызова:

```ts showLineNumbers
{
  residence_list: 1; // Имя метода вызова Api
  passthrough?: object; // Необязательно
  req_id?: number; // Необязательно
}
```

Поле `residence_list` является `именем метода` для вызова и является обязательным. Могут быть и другие обязательные поля, относящиеся к данному типу запроса, который Вы хотите отправить. Чтобы узнать больше о `Residence List` и других вызовах API, пожалуйста, ознакомьтесь с ними в [API Explorer](/api-explorer#residence_list).

### Обязательные поля

Каждый вызов также имеет несколько полей `Optional`. `Passthrough` и `req_id` всегда являются частью данных запроса, но Вы можете отказаться от их использования и не использовать их.

#### Поле `passthrough`

Все, что Вы передадите в это поле, будет возвращено Вам обратно в объекте `ответ`. Это может быть полезно, когда Вам нужно смоделировать поток с состоянием для Ваших `запросов` и `ответов`.

#### Поле `req_id`

Вам может понадобиться "пометить" Ваши запросы и передать их через наши вызовы `WebSocket`. Вы можете сделать это, передав в это поле `число`. Это может быть полезно, когда Вам нужно сопоставить `запросы` с `ответами`.

:::caution
Чтобы узнать о дополнительных необязательных полях, специфичных для каждого вызова API, обратитесь к нашему [API Explorer](/api-explorer).
:::

## Ответные данные

Когда Вы получите ответ на вызов, в нем будет `Поле` с тем же именем, что и в `Имени метода`, которое содержит фактические данные.

Ответ на вызов `Residence List`:

```js showLineNumbers
{
  echo_req: {
    req_id: 1,
    residence_list: 1,
  },
  msg_type: 'residence_list',
  req_id: 1,
  residence_list: [
       {
            "identity": {
                "services": {
                    "idv": {
                        "documents_supported": {},
                        "has_visual_sample": 0,
                        "is_country_supported": 0
                    },
                    "onfido": {
                        "documents_supported": {
                            "driving_licence": {
                                "display_name": "Водительское удостоверение"
                            }
                        } },
                        "is_country_supported": 0
                    }
                }
            } },
            "phone_idd": "35818",
            "text": "Аландские острова",
            "value": "ax"
        },
        {
            "identity": {
                "services": {
                    "idv": {
                        "documents_supported": {},
                        "has_visual_sample": 0,
                        "is_country_supported": 0
                    },
                    "onfido": {
                        "documents_supported": {
                            "driving_licence": {
                                "display_name": "Водительское удостоверение"
                            },
                            "national_identity_card": {
                                "display_name": "National Identity Card"
                            },
                            "passport": {
                                "display_name": "Passport"
                            }
                        } },
                        "is_country_supported": 1
                    }
                }
            } },
            "phone_idd": "355",
            "text": "Албания",
            "tin_format": [
                "^[A-Ta-t0-9]\\d{8}[A-Wa-w]$"
            ],
            "value": "al"
        },
        // ....
  ],
};
```

Здесь `residence_list` - это `имя метода`, и он содержит фактические данные, которые Вы запросили. Чтобы не затягивать, мы не стали включать остальную часть массива. Вы можете проверить фактический ответ [здесь](/api-explorer#residence_list).

#### Поле `echo_req`

Это `поле` содержит точные `данные запроса`, которые Вы отправили на сервер.

#### Поле `msg_type`

Это `поле` поможет Вам определить, какие данные `сообщения` Вы получаете в событии сообщения соединения WebSocket. Например, обработчик события `onmessage` для Вашего WebSocket-соединения на `JavaScript` будет таким:

```js showLineNumbers
socket.onmessage = (event) => {
  const receivedMessage = JSON.parse(event.data);

  switch (receivedMessage.msg_type) {
    case "residence_list":
      console.log("The residence list is : ",receivedMessage.residence_list)
      break;
    case "other_request_identifier"
      console.log("ответ", receivedMessage.some_other_request_identifier)
    default:
      console.log("receivedMessage", receivedMessage)
      break;
  }
}
```

#### Поле `req_id`

Это `Опция`, передаваемая в `Данные запроса`, Вы можете использовать ее для `оценки`, `синхронизации`, `кэширования` и т.д.

:::tip
Параметр `msg_type` всегда присутствует в данных ответа.
:::
