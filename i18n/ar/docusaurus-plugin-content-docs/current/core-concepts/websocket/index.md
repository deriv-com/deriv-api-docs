---
title: ويب سوكيت
hide_title: false
draft: false
sidebar_label: ويب سوكيت
sidebar_position: 0
tags:
  - مفهوم
  - مأخذ الويب
keywords:
  - تطبيق التداول
  - بروتوكول الويب سوكيت
  - اتصالات الويب سوكيت
description: تعرّف على بروتوكول WebSocket واتصالات WebSocket، وكيفية دمجهما حتى تتمكن من تمكين تبادل البيانات على تطبيق التداول الخاص بك.
---

## ما هي WebSockets؟

يوفر بروتوكول 'WebSocket'، الموصوف في المواصفات [RFC 6455] (https://datatracker.ietf.org/doc/html/rfc6455)، طريقة لتبادل البيانات بين المتصفح والخادم عبر اتصال دائم. يمكن تمرير البيانات في كلا الاتجاهين كـ "حزم" دون قطع الاتصال أو الحاجة إلى طلبات HTTP إضافية.

يعد WebSocket رائعًا بشكل خاص للخدمات التي تتطلب تبادلًا مستمرًا للبيانات، مثل أنظمة التداول في الوقت الفعلي وما إلى ذلك.

## مثال بسيط

لفتح اتصال WebSocket، نحتاج إلى إنشاء "WebSocket" جديد باستخدام البروتوكول الخاص "ws" أو "wss" في عنوان url. إليك كيفية القيام بذلك في "جافا سكريبت":

```js
دع مأخذ التوصيل = WebSocket جديد('wss://ws.derivws.com/websockets/v3?app_id=1089');
```

:::caution
Using `wss://` is always the better choice. The `wss://` protocol is not only encrypted, but also more reliable.

من ناحية أخرى، لا يتم تشفير بيانات "ws://" ويمكن أن تكون مرئية للوسطاء. قد تواجه خوادم البروكسي القديمة رؤوساً "غريبة" وتقوم بإنهاء الاتصال.

يرمز "wss://" إلى WebSocket عبر TLS، على غرار HTTPS الذي يرمز إلى HTTP عبر TLS. باستخدام طبقة أمان النقل، يتم تشفير البيانات من قبل المرسل وفك تشفيرها من قبل المستقبل. هذا يعني أن حزم البيانات المشفرة يمكن أن تمر عبر البروكسيات بنجاح دون أن يتم فحصها.
:::

بمجرد إنشاء المقبس، يجب أن نستمع إلى الأحداث عليه. هناك 4 فعاليات إجمالاً:

- مفتوح - تم إنشاء الاتصال
- الرسالة - البيانات المستلمة
- خطأ - خطأ في WebSocket
- إغلاق - تم إغلاق الاتصال

يمكن إرسال رسالة عن طريق socket.send(data).

إليك مثال في 'جافا سكريبت':

```js showLineNumbers
const app_id = 1089؛ // استبدل بـ app_id الخاص بك أو اتركه على أنه 1089 للاختبار.
const socket = WebSocket جديد (`wss://wss.//ws.derivws.com/websockets/v3?app_id=${app_id}')؛

socket.onopen = الدالة (e) {
  console.log('[open] تم إنشاء الاتصال')؛
  console.log('إرسال إلى الخادم')؛
  const sendMessage = JSON.stringify({ ping: 1 })؛
  socket.send(sendMessage)؛
}؛

socket.onmessage = الدالة (الحدث) {
  console.log(``[message] data received from server: ${event.data}'')؛
}؛

socket.onclose = الدالة (الحدث) {
  if (event.wasClean) {
    consocket.log(`[إغلاق] تم إغلاق الاتصال بشكل نظيف، الرمز=${event.code} السبب=${event.reason}''؛
  }؛ } أخرى {
    // على سبيل المثال: عملية الخادم تم قتلها أو تعطلت الشبكة
    // عادةً ما يكون الرمز.event.code 1006 في هذه الحالة
    console.log('[إغلاق] مات الاتصال')؛
  }؛ }


؛ socket.onerror = الدالة (خطأ) {
  console.log(`[خطأ]'؛
};
```

## لماذا نحتاج إلى WebSockets ومتى يجب أن نتجنبها؟

WebSockets هي أداة اتصال أساسية بين العميل والخادم. للاستفادة القصوى من إمكاناتها، من المهم فهم كيف يمكن أن تكون مفيدة ومتى يكون من الأفضل تجنب استخدامها. يتم شرحه باستفاضة في القسم التالي.

استخدم WebSockets في الحالات التالية:

1. ‍عندما تقوم بتطوير تطبيق ويب في الوقت الفعلي.
   الاستخدام الأكثر شيوعًا ل WebSocket هو في تطوير التطبيقات في الوقت الفعلي حيث يساعد في عرض البيانات بشكل مستمر في نهاية العميل. نظرًا لأن الخادم الخلفي يرسل هذه البيانات بشكل مستمر، فإن WebSocket يسمح بدفع أو نقل هذه البيانات دون انقطاع في الاتصال المفتوح بالفعل. إن استخدام WebSockets يجعل نقل البيانات سريعاً ويعزز أداء التطبيق.
2. بالنسبة لمواقع التداول، مثل موقع المشتقات.
   هنا، يساعد WebSocket في معالجة البيانات التي يتم نقلها من الخادم الخلفي المنتشر إلى العميل.
3. ‍عند إنشاء تطبيق دردشة.
   يستعين مطورو تطبيقات المحادثة بمطوري WebSockets للمساعدة في عمليات مثل التبادل لمرة واحدة ونشر/بث الرسائل. نظراً لاستخدام نفس اتصال WebSocket لإرسال/استقبال الرسائل، يصبح الاتصال سهلاً وسريعاً.

الآن بعد أن حددنا أين يجب استخدام WebSockets، دعنا نرى أين من الأفضل تجنبها. سيساعدك ذلك على الابتعاد عن المتاعب التشغيلية غير الضرورية.

لا ينبغي استخدام WebSockets عندما يكون كل ما هو مطلوب هو جلب البيانات القديمة أو البيانات التي ستتم معالجتها مرة واحدة فقط. في هذه الحالات، يعد استخدام بروتوكولات HTTP خياراً حكيماً.

## WebSocket مقابل HTTP

نظرًا لاستخدام كل من بروتوكولي HTTP و WebSocket للاتصال بالتطبيقات، غالبًا ما يختلط الأمر على الناس ويجدون صعوبة في اختيار أحدهما.

كما ذكرنا سابقاً، WebSocket هو بروتوكول مؤطر وثنائي الاتجاه. من ناحية أخرى، HTTP هو بروتوكول أحادي الاتجاه يعمل فوق بروتوكول TCP.

نظرًا لأن بروتوكول WebSocket قادر على دعم النقل المستمر للبيانات، فإنه يُستخدم بشكل رئيسي في تطوير التطبيقات في الوقت الفعلي. HTTP عديم الحالة ويستخدم لتطوير تطبيقات [RESTful] (https://de.wikipedia.org/wiki/Representational_State_Transfer) و [SOAP] (https://de.wikipedia.org/wiki/SOAP). لا يزال بإمكان SOAP استخدام HTTP للتنفيذ، لكن REST منتشر ومستخدم على نطاق واسع.

في WebSocket، يحدث الاتصال في كلا الطرفين، مما يجعله بروتوكولاً أسرع. في HTTP، يتم إنشاء الاتصال في أحد طرفيه، مما يجعله أكثر بطئًا قليلاً من WebSocket.

يستخدم WebSocket اتصال TCP موحد ويحتاج إلى طرف واحد لإنهاء الاتصال. حتى يحدث ذلك، يظل الاتصال نشطاً. يحتاج HTTP إلى إنشاء اتصال مميز لطلبات منفصلة. بمجرد اكتمال الطلب، ينقطع الاتصال تلقائياً.

## كيف يتم إنشاء اتصالات WebSocket؟

تبدأ العملية بمصافحة WebSocket التي تتضمن استخدام مخطط جديد (ws أو wss). لمساعدتك على الفهم، اعتبرهما مكافئين لـ HTTP و HTTP الآمن (HTTPS) على التوالي.

باستخدام هذا المخطط، من المتوقع أن تتبع الخوادم والعملاء بروتوكول اتصال WebSocket القياسي. تبدأ عملية إنشاء اتصال WebSocket بترقية طلب HTTP الذي يحتوي على بعض الرؤوس مثل Connection: ترقية، وترقية: WebSocket، و Sec-WebSocket- Key، وهكذا.

إليك كيفية إنشاء هذا الاتصال:

1. **الطلب:** يشير رأس ترقية الاتصال إلى مصافحة WebSocket بينما يتميز مفتاح Sec-WebSocket-Key بقيمة عشوائية مشفرة Base64. يتم إنشاء هذه القيمة بشكل اعتباطي أثناء كل مصافحة WebSocket. بالإضافة إلى ما سبق، فإن رأس المفتاح هو أيضًا جزء من هذا الطلب.

تشكل الرؤوس المذكورة أعلاه، عند دمجها، طلب HTTP GET. سيحتوي على بيانات مماثلة في ذلك:

```
احصل على ws://websocketexample.com:8181/ HTTP/1.1
المضيف: المضيف: المضيف المحلي:8181
الاتصال: الترقية
براغما: لا-ذاكرة مؤقتة
التحكم في ذاكرة التخزين المؤقت: لا-ذاكرة مؤقتة
الترقية: websocket
Sec-WebSocket-Version: 13
Sec-WebSocket-Key: b6gjjhT32u488lpuRwKaOWs==
```

لتوضيح Sec-WebSocket-Version، يمكن للمرء أن يشرح إصدار بروتوكول WebSocket الجاهز للاستخدام للعميل.

2. **الاستجابة:** يتميز رأس الاستجابة، Sec-WebSocket-Accept، ببقية القيمة المقدمة في رأس طلب Sec-WebSocket-Key. ويرتبط هذا الأمر بمواصفات بروتوكول معين ويستخدم على نطاق واسع لإبعاد المعلومات المضللة. وبعبارة أخرى، فإنه يعزز أمان واجهة برمجة التطبيقات ويمنع الخوادم غير المهيأة بشكل جيد من إحداث أخطاء فادحة في تطوير التطبيق.

عند نجاح الطلب الذي تم إرساله مسبقاً، سيتم استلام رد مشابه للتسلسل النصي المذكور أدناه:

```
HTTP/1.1 101 تبديل البروتوكولات
ترقية: websocket
اتصال: الترقية
Sec-WebSocket-Accept: rG8wsswsswmHTHTJ85lJgAE3M5RTmcCE=
```

## المراجع

- \*\* [WebSockets APIs - MDN](https://developer.mozilla.org/en-US/docs/Web/API/WebSocket)\*\*
- \*\* [WebSocket - معلومات جافا سكريبت] (https://javascript.info/websocket)\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*
