---
title: وظائف مكالمات واجهة برمجة التطبيقات
hide_title: false
draft: false
sidebar_label: وظائف مكالمات واجهة برمجة التطبيقات
sidebar_position: 1
tags:
  - مفهوم
  - استدعاءات
  - ترتيب عناصر
keywords:
  - تطبيق التداول
  - مكالمات واجهة برمجة التطبيقات
  - مثال على واجهة برمجة التطبيقات
description: قم بإعداد مكالمات API لتطبيق التداول الخاص بك باستخدام ميزة مكالمات API. تعلم كيفية الاشتراك وإرسال الطلبات والحصول على بيانات الاستجابة من خلال أمثلة واجهة برمجة التطبيقات.
---

## اشترك وأرسل

تحتوي جميع استدعاءات API على وظيفة إرسال لتقديم طلب وتلقي استجابة. توفر بعض استدعاءات API أيضًا وظيفة اشتراك تسمح بإرسال التحديثات إلى تطبيقك عندما تتوفر معلومات جديدة.

### اشترك

توفر العديد من استدعاءات API وظيفة "الاشتراك". عندما تشترك في استدعاء API، ستتلقى تدفقًا مستمرًا من بيانات هذا الاستدعاء.

بعض مكالمات واجهة برمجة التطبيقات هذه تشترك تلقائيًا (على سبيل المثال [ticks] (/api-explorer#ticks) وبعضها يحتوي على حقل "اشتراك" اختياري. إذا قمت بتمرير "1" إلى حقل "الاشتراك"، سيبدأ الاشتراك وسيستمر الخادم في إرسال البيانات المطلوبة حتى تقوم بإلغاء الاشتراك عن طريق استدعاء استدعاء "نسيت" أو "نسيت الكل" من مكالمات واجهة برمجة التطبيقات.

على سبيل المثال، يمكنك استدعاء [سجل التجزئة] (/apiexplorer#ticks_history) لتلقي بيانات سجل التجزئة. ولكن عند إضافة خيار "اشتراك" إلى هذه المكالمة، ستتلقى بيانات سجل التجزئة التي طلبتها في الاستجابة الأولى، وستستمر في تلقي استجابة جديدة في كل مرة يتم فيها نشر علامة جديدة من قبل الخادم للرمز المحدد.

في تدفق الرسائل من 'اشتراك'، يوجد حقل يسمى 'اشتراك'. هذا هو "معرّف الدفق". باستخدام هذا المعرف، يمكنك تحديد دفق الرسائل في منطقك وإيقاف الدفق باستخدام استدعاءات واجهة برمجة التطبيقات "انسَ" و"انسَ الكل".

يمكن استخدام البيانات التي توفرها مكالمات واجهة برمجة التطبيقات مع وظيفة "الاشتراك" كمصدر بيانات لمكالمات وميزات واجهة برمجة التطبيقات الأخرى.

### إرسال

إذا قمت باستدعاء واجهة برمجة التطبيقات باستخدام وظيفة "الإرسال"، فسيقوم الخادم بإرسال البيانات المطلوبة مرة واحدة فقط. للحصول على بيانات محدثة، يجب عليك إرسال استدعاء API مرة أخرى. عادةً ما تُستخدم هذه الطريقة عندما تحصل على استجابات أخرى لمكالمات واجهة برمجة التطبيقات أو أحداث واجهة المستخدم مثل "النقر" و "التمرير" وغيرها.

### نسيان

إذا كنت ترغب في إيقاف دفق الرسائل الذي تم إنشاؤه بواسطة "اشتراك"، فسيتعين عليك استدعاء استدعاء "نسيت" استدعاء واجهة برمجة التطبيقات باستخدام "معرف الدفق" الصحيح. بخلاف ذلك، يمكنك استخدام استدعاء "نسيان الكل" من واجهة برمجة التطبيقات لإيقاف التدفقات عن طريق "اسم الطريقة".

:::caution
لمزيد من المعلومات حول استدعاء "نسيت" لواجهة برمجة التطبيقات، ألقِ نظرة على [نسيت] (/api-explorer#forget) و [نسيت الكل] (/api-explorer#forget_all) في مستكشف واجهة برمجة التطبيقات.
:::

## بيانات الطلب

لتسهيل عملية التعامل مع تدفق الطلبات والردود في اتصال WebSocket الخاص بك، يتبع كل Deriv WebSocket API هيكل موحد. يمكنك استخدامه للتخزين المؤقت والتحقق والطلب ومزامنة الاستجابة.

#### اسم طريقة استدعاء API

يتضمن كل "طلب" في واجهة برمجة تطبيقات WebSocket حقل "اسم الطريقة" الذي يعمل كمعرف فريد للطلب. في معظم الحالات، سيحصل "اسم الطريقة" هذا على قيمة رقمية "1". ومع ذلك، هناك بعض الحالات التي قد تحتوي فيها خاصية المعرف على قيمة "سلسلة".

:::caution
اسم أسلوب استدعاء API مطلوب دائمًا. يحدد هذا الحقل البيانات التي ستحصل عليها من خادم WebSocket الخاص بنا.
:::

### الحقول المطلوبة

تحتوي بيانات كل طلب على حقول إلزامية يجب عليك تقديمها، وقد تتضمن أيضًا حقولًا اختيارية. دعونا نستكشف ذلك بمثال من "قائمة الإقامة".

تقوم مكالمة "قائمة الإقامة" بإرجاع قائمة بالبلدان ورموز البلدان المكونة من حرفين والمناسبة لملء نموذج فتح الحساب.

بيانات الطلب لهذا الاستدعاء هي كما يلي:

```ts showLineNumbers
{
  residence_list: 1; // Api Call Method Name
  passthrough?: object; // Optional
  req_id?: number; // Optional
}
```

حقل "قائمة_الإقامة" هو "اسم الطريقة" للاستدعاء وهو مطلوب. قد تكون هناك حقول أخرى مطلوبة تتعلق بهذا النوع من الطلبات التي تريد إرسالها. لمعرفة المزيد حول "قائمة الإقامة" ومكالمات واجهة برمجة التطبيقات الأخرى، يرجى الاطلاع عليها في [مستكشف واجهة برمجة التطبيقات] (/api-explorer#residence_list).

### حقول اختيارية

تحتوي كل مكالمة على عدة حقول "اختيارية" أيضًا. دائمًا ما يكون "المرور" و"req_id" جزءًا من بيانات الطلب، ولكن يمكنك اختيار إلغاء الاشتراك وعدم استخدامهما.

#### حقل "المرور

سيتم إرجاع كل ما تمرره إلى هذا الحقل إليك داخل كائن "استجابة". يمكن أن يكون هذا مفيدًا عندما تحتاج إلى محاكاة تدفق الحالة لـ "الطلبات" و"الردود".

#### الحقل "req_id

قد تحتاج إلى "وضع علامة" على طلباتك وتمريرها من خلال مكالمات "WebSocket". يمكنك القيام بذلك عن طريق تمرير "رقم" إلى هذا الحقل. يمكن أن يكون مفيدًا عندما تحتاج إلى ربط "الطلبات" بـ "الاستجابات".

:::caution
للتعرف على الحقول الاختيارية الإضافية الخاصة بكل استدعاء من استدعاءات واجهة برمجة التطبيقات، يُرجى الرجوع إلى [مستكشف واجهة برمجة التطبيقات] (/api-explorer).
:::

## بيانات الاستجابة

عندما تحصل على الرد على المكالمة، سيكون هناك "حقل" بنفس اسم "اسم الطريقة"، والذي يحتوي على البيانات الفعلية.

الرد على مكالمة "قائمة الإقامة":

```js showLineNumbers
{
  echo_req: {
    req_id: 1,
    residence_list: 1,
  },
  msg_type: 'residence_list',
  req_id: 1,
  الإقامة_القائمة: [
       {
            "الهوية": {
                "الخدمات": {
                    "idv": {
                        "المستندات_مدعومة": {},
                        "has_visual_sample": 0,
                        "is_country_supported": 0
                    },
                    "onfido": {
                        "المستندات_مدعومة": {
                            "رخصة_قيادة": {
                                "اسم_العرض": "رخصة القيادة"
                            }، "رخصة القيادة": {
                        }،
                        "is_country_supported": 0
                    }
                }
            }،
            "phone_idd": "35818"،
            "النص": "جزر ألاند"،
            "القيمة": "ax"
        }،
        {
            "هوية": {
                "الخدمات": {
                    "idv": {
                        "المستندات_مدعومة": {},
                        "has_visual_sample": 0,
                        "is_country_supported": 0
                    },
                    "onfido": {
                        "المستندات_مدعومة": {
                            "رخصة_قيادة": {
                                "اسم_العرض": "Driving Licence"
                            },
                            "national_identity_card": {
                                "اسم_العرض": { "display_name": "بطاقة الهوية الوطنية"
                            }،
                            "جواز السفر": {
                                "اسم_العرض": "جواز السفر"
                            }.
                        }،
                        "is_country_supported": 1
                    }
                }
            }،
            "phone_idd": "355"،
            "نص": "ألبانيا"،
            "tin_format": [
                " "^ [A-Ta-ta-t0-9]\\d{8}[A-Wa-w] $"
            ]،
            "القيمة": "al"
        }،
        // ....
  ]،
};
```

هنا "قائمة_الإقامة" هي "اسم الطريقة"، وتحتوي على البيانات الفعلية التي طلبتها. وللاختصار، لم نقم بتضمين بقية المصفوفة. يمكنك التحقق من الاستجابة الفعلية [هنا] (/apiexplorer#residence_list).

#### حقل "صدى_الطلب

يحتوي هذا "الحقل" على "بيانات الطلب" الدقيقة التي أرسلتها إلى الخادم.

#### حقل "نوع_الرسالة

يساعدك هذا 'الحقل' على تحديد بيانات 'الرسالة' التي تحصل عليها في حدث الرسالة الخاصة باتصال WebSocket. على سبيل المثال، سيكون معالج الأحداث 'onmessage' الخاص بك لاتصال WebSocket في 'جافا سكريبت' هو

```js showLineNumbers
socket.onmessage = (حدث) => {
  const receivedMessage = JSON.parse(event.data);

  التبديل (receivedMessage.msg_type) {
    حالة "residence_list":
      console.log("قائمة الإقامة هي: ",receivedMessage.Residence_list)
      فاصل؛
    حالة "معرف_مستلم_مستلم"
      وحدة التحكم console.log("الاستجابة"، معرف_مستلم_مستلم.some_آخر_مستلم_مستلم)
    افتراضي:
      افتراضي: وحدة التحكم .log("مستلم"، مستلم)
      فاصل؛
  }.
}
```

#### الحقل "req_id

هذا هو "الاختياري" الذي يتم تمريره إلى "بيانات الطلب"، يمكنك استخدامه لـ "التحقق" و"المزامنة" و"التخزين المؤقت" وما إلى ذلك.

:::tip
يكون "نوع_الرسالة" موجودًا دائمًا في بيانات الاستجابة.
:::
