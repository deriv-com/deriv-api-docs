#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# ShiftAI Pre-push Hook - Intercept push for AI analysis and PR management
# Git pre-push hook passes: $1=remote_name, $2=remote_url

# 🗑️ EARLY EXIT: Check for delete operations at shell level
if ps aux | grep -v grep | grep -q "git.*push.*--delete"; then
  exit 0
fi

# Check command line arguments in current process tree
if pgrep -f "git.*push.*--delete" > /dev/null 2>&1; then
  exit 0
fi

export GIT_PUSH_REMOTE_NAME="$1"
export GIT_PUSH_REMOTE_URL="$2"

npx @deriv-com/shiftai-cli hook pre-push

exit $?