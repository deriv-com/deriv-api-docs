---
title: ฟังก์ชั่นของการโทร API
hide_title: false
draft: false
sidebar_label: ฟังก์ชั่นของการโทร API
sidebar_position: 1
tags:
  - แนวคิด
  - การเรียกใช้งาน
  - โครงสร้าง
keywords:
  - แอพการซื้อขาย
  - การโทร API
  - ตัวอย่าง API
description: ตั้งค่าการเรียกใช้ API สำหรับแอปซื้อขายของคุณโดยใช้คุณลักษณะการโทร API ด้วยตัวอย่าง API เรียนรู้ที่จะสมัครสมาชิกส่งคำขอและรับข้อมูลการตอบกลับ
---

## สมัครสมาชิกและส่ง

การเรียกใช้งาน API ทั้งหมดมีฟังก์ชั่นการส่งเพื่อที่จะทำการร้องขอและรับการตอบสนอง บางการเรียกใช้งาน API ก็ยังมีฟังก์ชั่นการสมัครสมาชิกที่ช่วยให้สามารถส่งข้อมูลอัปเดตไปยังแอปพลิเคชั่นของคุณเมื่อมีข้อมูลใหม่ออกมา

### สมัครสมาชิกเพื่อติดตามข้อมูล

การโทร API หลายรายการให้ฟังก์ชัน “สมัครสมาชิก” เมื่อคุณสมัครสมาชิกการใช้งาน API หนึ่งใด คุณจะได้รับการเผยแพร่สดที่ต่อเนื่องจากข้อมูลของการเรียกใช้งาน API นั้นโดยเฉพาะ

การเรียกใช้ API บางอย่างจะสมัครสมาชิกโดยอัตโนมัติ (เช่น [ticks] (/api-explorer #ticks)) และบางส่วนมีฟิลด์ “สมัครสมาชิก” ที่เป็นตัวเลือก หากคุณส่งผ่าน “1” ไปยังฟิลด์ “การสมัครสมาชิก” การสมัครสมาชิกจะเริ่มขึ้นและเซิร์ฟเวอร์จะส่งข้อมูลที่ร้องขอต่อไปจนกว่าคุณจะยกเลิกการสมัครโดยเรียกการโทร API “ลืม” หรือ “ลืมทั้งหมด”

ตัวอย่างเช่น คุณสามารถโทร [Tick History] (/api-explorer #ticks_history) เพื่อรับข้อมูลประวัติติ๊ก แต่เมื่อคุณเพิ่มตัวเลือก “สมัครสมาชิก” ในการโทรนี้ คุณจะได้รับข้อมูลประวัติติ๊กที่คุณร้องขอในการตอบกลับครั้งแรก และคุณจะยังคงได้รับการตอบกลับใหม่ทุกครั้งที่มีเครื่องหมายใหม่เผยแพร่โดยเซิร์ฟเวอร์สำหรับสัญลักษณ์ที่กำหนด

ในสตรีมข้อความจาก “สมัครสมาชิก” มีฟิลด์ที่เรียกว่า “การสมัครสมาชิก” นี่คือ “สตรีม ID” ด้วย ID นี้คุณสามารถระบุสตรีมข้อความในตรรกะของคุณและหยุดสตรีมด้วยการโทร API “ลืม” และ “ลืมทั้งหมด”

ข้อมูลที่ให้มาโดยการโทร API พร้อมฟังก์ชัน “สมัครสมาชิก” สามารถใช้เป็นแหล่งข้อมูลสำหรับการโทรและคุณสมบัติ API อื่น ๆ

### ส่ง (Send)

หากคุณเรียก API ด้วยฟังก์ชั่น “send” เซิร์ฟเวอร์จะส่งข้อมูลที่ร้องขอคืนเพียงครั้งเดียว ในการที่จะได้รับข้อมูลที่ถูกอัปเดต คุณจะต้องส่งการเรียกใช้งาน API อีกครั้ง โดยปกติวิธีนี้จะใช้เมื่อคุณได้รับการตอบสนองการโทร API อื่น ๆ หรือเหตุการณ์ UI เช่น `Click`, `Scroll` และอื่น ๆ

### ให้ลืมไป (Forget)

หากคุณต้องการหยุดสตรีมข้อความที่สร้างโดย `สมัครสมาชิก` คุณจะต้องเรียกการโทร API `ลืม` ด้วย `Stream ID` ที่ถูกต้อง มิฉะนั้นคุณสามารถใช้การเรียกใช้ API `ลืมทั้งหมด` เพื่อหยุดสตรีมตาม `ชื่อวิธี`

:::caution
สำหรับข้อมูลเพิ่มเติมเกี่ยวกับการเรียกใช้ API `ลืม` โปรดดูที่ [ลืม] (/api-explorer #forget) และ [ลืมทั้งหมด] (/api-explorer #forget_all) ใน API explorer
:::

## ข้อมูลคำร้องขอ

เพื่อทำให้ง่ายขึ้นสำหรับคุณที่จะจัดการกับกระแสหรือโฟลว์ของคำร้องขอและการตอบรับของการเชื่อมต่อ WebSocket ของคุณ การเรียกใช้งาน API ของแต่ละ Deriv WebSocket นั้นจะเป็นไปตามโครงสร้างมาตรฐาน คุณสามารถใช้มันสำหรับการทำแคช การยืนยันความถูกต้อง การร้องขอ และการประสานข้อมูลการตอบสนอง

#### ชื่อวิธีการเรียกใช้งาน API

“คำขอ” ทุก ๆ ใน WebSocket API มีฟิลด์ `ชื่อวิธี' ที่ทำหน้าที่เป็นตัวระบุที่ไม่ซ้ำกันสำหรับคำขอ ในกรณีส่วนใหญ่ `ชื่อวิธีนี้จะได้ค่าตัวเลข `1` แต่มีบางกรณีที่คุณสมบัติตัวระบุอาจมีค่าสตริง

:::caution
ต้องใช้ชื่อวิธีการโทร API เสมอ ฟิลด์นี้จะกำหนดข้อมูลที่คุณจะได้รับจากเซิร์ฟเวอร์ WebSocket ของเรา
:::

### ฟิลด์ที่ต้องกรอก

ข้อมูลคำร้องขอแต่ละรายการมีฟิลด์ให้ใส่ข้อมูลบังคับที่คุณต้องระบุ และอาจรวมถึงฟิลด์ข้อมูลเสริมที่ไม่บังคับ ลองสำรวจสิ่งนี้ด้วยตัวอย่างจาก “รายชื่อที่อยู่อาศัย”

การโทร “รายชื่อที่อยู่อาศัย” จะส่งกลับรายการประเทศและรหัสประเทศ 2 ตัวอักษร เหมาะสำหรับการกรอกแบบฟอร์มการเปิดบัญชี

ข้อมูลคำร้องขอสำหรับการเรียกใช้งานนี้มีดังต่อไปนี้:

```ts showLineNumbers
{
  residence_list: 1; // Api Call Method Name
  passthrough?: object; // Optional
  req_id?: number; // Optional
}
```

ฟิลด์ `เรสซิเดนซ์_list` คือ \`ชื่อวิธี' สำหรับการโทรและจำเป็นต้องใช้ อาจมีฟิลด์อื่นๆ ที่จำเป็นและซึ่งเกี่ยวข้องกับประเภทของคำร้องขอที่คุณต้องการส่ง หากต้องการทราบข้อมูลเพิ่มเติมเกี่ยวกับ “รายชื่อที่อยู่อาศัย” และการโทร API อื่น ๆ โปรดตรวจสอบใน [API Explorer] (/api-explorer #residence_list)

### ฟิลด์ข้อมูลเสริม

ทุกการโทรมีฟิลด์ “ตัวเลือก” หลายช่อง “Passthrough” และ “req_id” เป็นส่วนหนึ่งของข้อมูลคำขอเสมอ แต่คุณสามารถเลือกที่จะยกเลิกและไม่ใช้ได้

#### ฟิลด์ “การผ่าน”

สิ่งที่คุณส่งผ่านไปยังฟิลด์นี้จะถูกส่งกลับมาให้คุณภายในวัตถุ \`ตอบสนอง' สิ่งนี้มีประโยชน์เมื่อคุณต้องการจำลองการไหลตามสถานะสำหรับ “คำขอ” และ “คำตอบ” ของคุณ

#### ฟิลด์ “req_id”

คุณอาจต้อง “แท็ก” คำขอของคุณและส่งผ่านการโทร “WebSocket” ของเรา คุณสามารถทำได้โดยส่งตัวเลข “ไปยังฟิลด์นี้ มันอาจเป็นประโยชน์เมื่อคุณต้องการกำหนดแผนที่ “คำขอ” เป็น “คำตอบ”

:::caution
หากต้องการเรียนรู้เกี่ยวกับฟิลด์เสริมเพิ่มเติมที่เฉพาะสำหรับการโทร API แต่ละครั้ง โปรดดูที่ [API Explorer] (/api-explorer) ของเรา
:::

## ข้อมูลการตอบสนอง

เมื่อคุณได้รับการตอบสนองสำหรับการโทร จะมี “ฟิลด์” ที่มีชื่อเดียวกับ “ชื่อวิธีการ” ซึ่งมีข้อมูลจริง

การตอบสนองสำหรับการโทร “รายชื่อที่อยู่อาศัย”:

```js showLineNumbers
{
  echo_req: {
    req_id: 1,
    residence_list: 1,
  },
  msg_type: 'รายการที่อยู่อาศัย',
  req_id: 1,
  รายชื่อที่อยู่อาศัย: [
       {
            “ตัวตน”: {
                “บริการ”: {
                    “idv”: {
                        “เอกสาร_สนับสนุน”: {},
                        “has_visual_ตัวอย่าง”: 0,
                        “ได้รับการสนับสนุนจากประเทศ”: 0
                    },
                    “ไม่ถูกต้อง”: {
                        “รองรับเอกสารแล้ว”: {
                            “ใบอนุญาตขับขี่”: {
                                “display_name”: “ใบขับขี่”
                            }
                        },
                        “is_country_supported”: 0
                    }}
                }
            },
            “phone_idd”: “35818",
            “text”: “หมู่เกาะโอลันด์”,
            “value”: “ax”
        },
        {
            “ตัวตน”: {
                “บริการ”: {
                    “idv”: {
                        “เอกสาร_สนับสนุน”: {},
                        “has_visual_sample”: 0,
                        “ได้รับการสนับสนุนจากประเทศ”: 0
                    },
                    “ไม่ถูกต้อง”: {
                        “รองรับเอกสารแล้ว”: {
                            “ใบอนุญาตขับขี่”: {
                                “display_name”: “ใบขับขี่”
                            },
                            “บัตรประจำตัวแห่งชาติ”: {
                                “display_name”: “บัตรประจำตัวประจำชาติ”
                            },
                            “หนังสือเดินทาง”: {
                                “display_name”: “หนังสือเดินทาง”
                            }
                        },
                        “is_country_supported”: 1
                    }
                }
            },
            “phone_idd”: “355",
            “text”: “แอลเบเนีย”,
            “tin_format”: [
                “^ [A-ta-T0-9]\\ d{8}[A-wa-W] $”
            ],
            “ค่า”: “al”
        },
        //...
  ],
};
```

ที่นี่ `Residence_list` คือ `ชื่อวิธี` และมันมีข้อมูลจริงที่คุณร้องขอ ทั้งนี้ เพื่อทำให้ดูสั้นกระชับ เราจึงยังไม่ได้รวมส่วนที่เหลือของอาร์เรย์ คุณสามารถตรวจสอบการตอบสนองจริงได้ [ที่นี่] (/api-explorer #residence_list)

#### ฟิลด์ “echo_req”

“ฟิลด์” นี้มี “ข้อมูลคำขอ” ที่แน่นอนที่คุณส่งไปยังเซิร์ฟเวอร์

#### ฟิลด์ “msg_type”

“ฟิลด์” นี้ช่วยให้คุณกำหนดข้อมูล `ข้อความ 'ที่คุณได้รับจากเหตุการณ์ข้อความของการเชื่อมต่อ WebSocket ตัวอย่างเช่น ตัวจัดการเหตุการณ์ `onmessage`ของคุณสำหรับการเชื่อมต่อ WebSocket ใน`Javascript\` จะเป็น:

```js showLineNumbers
socket.onmessage = (กิจกรรม) => {
  const ReceivedMessage = JSON.parse (event.data); สวิตช์

  (ReceivedMessage.msg_type) {
    เคส “รายการที่อยู่อาศัย”:
      console.log (“รายการที่อยู่อาศัยคือ: “, ReceivedMessage.Residence_List)
      break;
    เคส “other_request_address”
      console.log (“การตอบสนอง”, ข้อความ บางคนอื่น_ตัวระบุคำขอ)
    ค่าเริ่มต้น:
      console.log (“รับข้อความ”, ข้อความที่ได้รับแล้ว)
      break;
  }
}
```

#### ฟิลด์ “req_id”

นี่คือ “ตัวเลือก” ที่ส่งไปที่ “คำขอข้อมูล” คุณสามารถใช้สำหรับ “การตรวจสอบ”, “ซิงโครไนซ์”, “แคช” ฯลฯ

:::tip
“msg_type” มีอยู่ในข้อมูลการตอบสนองเสมอ
:::
